{# operation/templates/operation/partials/_courier_invoice_list_content.html #}

<div class="bg-white shadow-md rounded-lg overflow-hidden">
    <table class="min-w-full leading-normal">
        <thead class="bg-gray-100">
            <tr>
                <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Courier</th>
                <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Invoice #</th>
                <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Invoice Date</th>
                <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Amount</th>
                <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Discount</th>
                <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Payment Date</th>
                <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Payment Status</th>
                <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Parcels</th>
                <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
            </tr>
        </thead>
        <tbody id="invoice-table-body">
            {% for invoice in invoices %}
            <tr class="hover:bg-gray-50">
                <td class="px-5 py-4 border-b border-gray-200 bg-white text-sm">{{ invoice.courier_company.name }}</td>
                <td class="px-5 py-4 border-b border-gray-200 bg-white text-sm">{{ invoice.invoice_number|default:"N/A" }}</td>
                <td class="px-5 py-4 border-b border-gray-200 bg-white text-sm">{% if invoice.invoice_date %}{{ invoice.invoice_date|date:"Y-m-d" }}{% else %}N/A{% endif %}</td>
                <td class="px-5 py-4 border-b border-gray-200 bg-white text-sm text-right">{{ invoice.invoice_amount|default:"N/A" }}</td>
                <td class="px-5 py-4 border-b border-gray-200 bg-white text-sm">
                    {% if invoice.discount_amount != 0 %}
                        <span class="text-success font-bold">{{ invoice.discount_amount|floatformat:2 }}</span>
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td class="px-5 py-4 border-b border-gray-200 bg-white text-sm">
                    {% if invoice.payment_date %}
                        {{ invoice.payment_date|date:"Y-m-d" }}
                    {% else %}
                        <span class="text-gray-500">Not Paid</span>
                    {% endif %}
                </td>
                <td class="px-5 py-4 border-b border-gray-200 bg-white text-sm">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full
                        {% if invoice.payment_status == 'PAID' %} bg-green-100 text-green-800
                        {% else %} bg-red-100 text-red-800 {% endif %}">
                        {{ invoice.get_payment_status_display }}
                    </span>
                </td>
                <td class="px-5 py-4 border-b border-gray-200 bg-white text-sm text-center">{{ invoice.items.count }}</td>
                <td class="px-5 py-4 border-b border-gray-200 bg-white text-sm">

                    {% if invoice.payment_date and invoice.payment_amount is not None %}
                        <button class="btn btn-xs btn-success" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>
                            Paid
                        </button>
                    {% else %}
                    <button class="btn btn-xs btn-outline js-edit-payment"
                            data-invoice-id="{{ invoice.id }}"
                            data-invoice-number="{{ invoice.invoice_number }}"
                            data-payment-date="{{ invoice.payment_date|date:'Y-m-d'|default:'' }}"
                            data-invoice-amount="{{ invoice.invoice_amount|floatformat:2|default:'0.00' }}"
                            data-payment-amount="{{ invoice.payment_amount|floatformat:2|default:'' }}">
                        Payment
                    </button>
                    {% endif %}

                    <a href="{{ invoice.invoice_file.url }}" class="text-blue-600 hover:text-blue-800 ml-3" download>Download</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="9" class="text-center py-10 text-gray-500">No invoices found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="mt-4 parcel-pagination-controls text-center">
    {% if invoices.has_other_pages %}
        <div class="join">
            {% if invoices.has_previous %}
                <button class="join-item btn btn-sm invoice-page-btn" data-page="{{ invoices.previous_page_number }}">« Prev</button>
            {% endif %}
            {% for i in invoices.paginator.page_range %}
                {% if invoices.number == i %}
                    <button class="join-item btn btn-sm btn-active">{{ i }}</button>
                {% elif i > invoices.number|add:'-3' and i < invoices.number|add:'3' %}
                    <button class="join-item btn btn-sm invoice-page-btn" data-page="{{ i }}">{{ i }}</button>
                {% elif i == invoices.paginator.page_range.0 or i == invoices.paginator.page_range.last %}
                     <button class="join-item btn btn-sm btn-disabled">...</button>
                {% endif %}
            {% endfor %}
            {% if invoices.has_next %}
                 <button class="join-item btn btn-sm invoice-page-btn" data-page="{{ invoices.next_page_number }}">Next »</button>
            {% endif %}
        </div>
    {% endif %}
</div>
