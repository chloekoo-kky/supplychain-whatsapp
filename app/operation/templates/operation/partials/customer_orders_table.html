{% load i18n %}
{% load humanize %}

{# Sticky Filter Panel for Customer Orders - Changed items-center to items-start for top alignment #}
<div class="operations-filter-panel sticky top-8 md:top-24 bg-base-200 shadow px-4 py-2 rounded-lg z-40 mb-4">
    <div class="grid grid-cols-12 gap-2">

        <div class="col-span-12 md:col-span-1 items-start"> {# Count Column #}
            <div class="text-lg">
                <div class="font-semibold text-gray-800">
                    New: <span class="text-orange-500 font-bold customer-new-order-count">{{ new_orders_count|default:0 }}</span>
                </div>
                <div class="font-semibold text-gray-800">
                    Partial: <span class="text-blue-600 font-bold customer-partial-order-count">{{ partial_orders_count|default:0 }}</span>
                </div>
            </div>
        </div>

        {# Widened this container from md:col-span-1 to md:col-span-2 to give buttons more space #}
        <div class="col-span-12 md:col-span-3 mb-2 md:mr-4">
            {# Removed 'grid-flow-col' and 'auto-cols-fr' to allow wrapping #}
            <div id="warehouse-filter-container" class="
                    grid gap-2
                    {% if warehouses|length >= 3 %}
                        md:grid-cols-2
                    {% else %}
                        md:flex md:flex-col
                    {% endif %}
                ">

                {% if request.user.is_superuser %}
                    {% for wh in warehouses %}
                    <button type="button" class="btn btn-sm sm:btn-sm warehouse-filter-btn btn-outline" data-value="{{ wh.pk }}">
                        {{ wh.name }}
                    </button>
                    {% endfor %}
                {% else %}
                    {# Your non-superuser logic remains the same #}
                    {% if request.user.warehouse %}
                    <button type="button" class="btn btn-sm md:btn-sm btn-neutral text-white">
                        {{ request.user.warehouse.name }}
                    </button>
                    {% else %}
                    <button type="button" class="btn btn-xs sm:btn-sm btn-error text-white" disabled>
                        No WH Assigned
                    </button>
                    {% endif %}
                {% endif %}
            </div>
        </div>
        {# Adjusted this container from md:col-span-6 to md:col-span-5 to make space #}
        <div class="col-span-12 md:col-span-5 flex flex-col gap-2">
            <div class="grid grid-flow-col auto-cols-fr gap-2">
                {% for code, display_name in status_choices %}
                <button type="button" class="btn btn-sm status-filter-btn btn-outline" data-value="{{ code }}">{{ display_name }}</button>
                {% endfor %}
            </div>
            <div class="flex items-center gap-2">
                <input type="text" name="q" value="{{ query|default:'' }}" placeholder="Search Orders..."
                       class="input input-bordered input-sm w-full dynamic-search-input">
                <button type="button" class="btn btn-sm btn-outline bg-gray-300 flex-shrink-0 reset-filters-btn">Reset Filters</button>
            </div>
        </div>

        <div class="col-span-12 md:col-span-3 flex md:justify-end items-end md:ml-5 py-2">
            <label for="import-orders-modal-toggle" class="btn btn-sm bg-white hover:bg-gray-400 hover:border-gray-900 hover:text-white text-gray-700 border-gray-900 w-full md:btn-md">Import Orders</label>
        </div>
    </div>
</div>

{# This container's content will be replaced by AJAX #}
<div id="customer-orders-dynamic-content">
    {% include 'operation/partials/_customer_orders_table_with_pagination.html' with orders=orders_page_obj customer_parcel_counts=customer_parcel_counts active_orders_count=active_orders_count %}
</div>
