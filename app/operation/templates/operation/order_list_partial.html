{% load my_filters %}

<div class="max-w-7xl mx-auto p-6">
  <h2 class="text-2xl font-bold mb-6">ğŸšš Orders</h2>

  {% for order in orders %}
    <div class="card bg-base-100 shadow-md p-4 mb-6 space-y-2">
      <div class="flex justify-between items-center">
        <h3 class="text-xl font-semibold">è®¢å•å·ï¼š#{{ order.id }}</h3>
        <span class="badge badge-info">{{ order.get_status_display }}</span>
      </div>
      <p><strong>Customer</strong> {{ order.customer }}</p>
      <p><strong>Order Dateï¼š</strong> {{ order.order_date }}</p>

      <div class="mt-4">
        <h4 class="font-bold mb-2">ğŸ“¦ å‘è´§åŒ…è£¹</h4>
        <ul class="list-disc ml-6 space-y-1">
          {% for parcel in order.all_parcels %}
            <li>
              äº§å“: {{ parcel.product.name }} |
              æ•°é‡: {{ parcel.quantity }} |
              å¿«é€’å…¬å¸: {{ parcel.courier_name }} |
              è¿å•å·: <strong>{{ parcel.tracking_number }}</strong>
            </li>
          {% empty %}
            <li class="text-gray-500">æš‚æ— å‘è´§</li>
          {% endfor %}
        </ul>
      </div>

      <div class="mt-4">
        <h4 class="font-bold mb-2">ğŸ›’ æœªå‘è´§äº§å“</h4>
        <ul class="list-disc ml-6 space-y-1">
          {% for item in order.all_order_items %}
          {% with shipped=order.shipped_quantities|get_item:item.product.id|default:0 %}
            {% if item.quantity > shipped %}
              <li>
                äº§å“: {{ item.product.name }} |
                å‰©ä½™: {{ item.quantity|subtract:shipped }}
              </li>
              {% endif %}
          {% endwith %}
          {% endfor %}
        </ul>
      </div>

    </div>
  {% endfor %}
</div>
